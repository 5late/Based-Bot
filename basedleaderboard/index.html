<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=, initial-scale=1.0">
    <meta content="Based Bot - New Global Based Leaderboard" property="og:title">
    <meta content="Stack up against dozens of other based users." property="og:description">
    <meta content="https://slatedev.xyz/basedbot/basedleaderboard" property="og:url">
    <title>Based Leaderboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alfa+Slab+One">
    <script src="https://kit.fontawesome.com/1c2c2462bf.js" crossorigin="anonymous"></script>
</head>
<style>
    @media only screen and (max-device-width: 575px){
        #leaderboard{
            position: relative;
            overflow-y: auto;
            overflow-x: clip !important;
            width: 20em !important;
            background-color: #f26060;
            border-radius: 10px;
            scrollbar-width: none;
        }
    }
    
    html{
        scrollbar-width: none;
    }

    h1{
        font-size: 2em;
        color: #e1e1e1;
        padding: 12px 13px 18px;
        font-family: 'Alfa Slab One';
    }

    body{
        width: 100vw;
        height: 100vh;
        background: linear-gradient(#64e9f3 0%, #606ff2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #leaderboard{
        position: absolute;
        width: 35em;
        height: 30em;
        overflow-y: auto;
        background-color: #606ff2;
        border-radius: 10px;
        scrollbar-width: none;
    }

    li{
        position: relative;
      z-index: 1;
      font-size: 14px;
      counter-increment: leaderboard;
      padding: 18px 0px 18px 0px;
      backface-visibility: hidden;
      transform: translateZ(0) scale(1.0, 1.0);
      list-style-type: none;
    }

    li::before {
        content: counter(leaderboard);
        position: absolute;
        z-index: 2;
        top: 15px;
        left: 15px;
        width: 20px;
        height: 20px;
        line-height: 20px;
        color: #c24448;
        background: #fff;
        border-radius: 20px;
        text-align: center;
    }

    li:hover{
        transform: scaleX(1.06) scaleY(1.03);
        transition: all 300ms ease-in-out;
        margin: 5px;
        border: 1px solid #fa6855;
        background-color: #5162fc;
    }

    li:nth-child(1) {
        background: #fa6855;
      }
    li:nth-child(2)::after {
        background: #fa6855;
    }

    mark{
        position: absolute;
        z-index: 2;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        padding: 18px 10px 18px 50px;
        margin: 0;
        background: none;
        color: #fff;    
        font-size: 1.1em;
    }

    mark::before,::after {
        content: '';
        position: absolute;
        z-index: 1;
        bottom: 11px;
        left: -0px;
        border-top: 10px solid #c24448;
        border-left: 10px solid transparent;
        transition: all .1s ease-in-out;
        opacity: 0;
    }

    mark::after {
        left: auto;
        right: -0px;
        border-left: none;
        border-right: 10px solid transparent;
        margin: 0;
    }

    .row{
        font-family: 'Oswald';
    }

    small{
        position: relative;
        z-index: 2;
        display: block;
        text-align: right;
        left: -10px;
        font-family: 'Raleway';
        font-size: 1.1em;
        cursor: pointer;
    }

    small::after {
        content: '';
        position: absolute;
        z-index: 1;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fa6855;
        box-shadow: 0 3px 0 rgba(0, 0, 0, .08);
        transform: scaleX(1.06) scaleY(1.03);
        transition: all .3s ease-in-out;
        opacity: 0;
    }
    #nest{
        padding: 0px;
    }
</style>
<body>
    <div id='leaderboard'>
        <h1>
            <i class="fas fa-trophy"></i>
            Based Leaderboard
        </h1>
        <ol id='nest'>
        </ol>
    </div>
    <div>
        <h2 id="username"></h2>
        <img src="" alt="avatar" id="avatar">
        <p id="creation"></p>
    </div>
</body>
<script>
    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    var lis = document.getElementById("nest").getElementsByTagName("small");

    var ids = []

    function getID(){
        [].forEach.call(lis, function (child) {
                if(child.innerText){
                    ids.push(child.innerText)
                    //console.log(child.innerText)
                }
                return ids
        });
    }
    
    window.onclick = e => {
        getID()
        //console.log(e.target)
        if (ids.includes(e.target.innerText)){
            let html_ranking = ids.indexOf(e.target.innerText)

            console.log(e.target.previousSibling.innerText)
            console.log(ids.indexOf(e.target.innerText))

            fetch('https://api.slatedev.xyz/api/basedbot/v1/globalbasedleaderboard').then(response => response.json()).then(json => {
                var data = json.data

                data.forEach(function(item, i){
                    if (data[i].ranking == html_ranking + 2) {
                        let discord_id_string = data[i].discord_id_string

                        fetch(`https://api.slatedev.xyz/api/basedbot/v1/user/${discord_id_string}`).then(response => response.json()).then(new_json => {
                            let title = new_json.data.based.based_title
                            let name = new_json.discord_name
                            let time = new_json.data.based.last_based_at
                            let spawn = new_json.created_at
                            let settings = new_json.settings
                            let badges = new_json.badges
                            
                            let modal = document.getElementById('modal')
                            let username = document.getElementById('username')
                            let avatar = document.getElementById('avatar')
                            let creation = document.getElementById('creation')

                            username.innerText = name

                            let based_div = document.createElement('div')
                            let based_count = document.createElement('p')
                            let based_time = document.createElement('p')

                            let cringe_div = document.createElement('div')
                            let cringe_count = document.createElement('p')
                            let cringe_time = document.createElement('p')

                            let show_badges = document.createElement('div')
                            let alpha_tester = document.createElement('p')
                            let easly_adopter = document.createElement('p')
                            let developer = document.createElement('p')
                            let owner = document.createElement('p')
                        })
                    }
                })
            })
        }
    }

    var leaderboard = document.getElementById('leaderboard')
    var nest = document.getElementById('nest')
    async function mainFunc(){
        fetch('https://api.slatedev.xyz/api/basedbot/v1/globalbasedleaderboard').then(response => response.json()).then(json => {
            var data = json.data
            console.log(data)
            let promises = []
            data.forEach(function(item, i){
                sleep(25)
                var discord_id_string = data[i].discord_id_string
                if (discord_id_string == "870487608105525298"){ 
                    return
                }
                var json_ranking = data[i].ranking
                var based_count = data[i].based_count
                var name = data[i].discord_name
                var table_row = document.createElement('li')
                table_row.className = 'row'
                var table_data = document.createElement('mark')
                var based_count_data = document.createElement('small')
                var ranking = document.createElement('td')

                if (name == ""){
                    fetch(`https://api.slatedev.xyz/api/basedbot/v1/user/${discord_id_string}`).then(response => response.json()).then(new_json => {
                        name = new_json['discord_name']
                        
                        table_data.innerText = name
                        table_row.appendChild(table_data)
                    })
                }

                table_data.innerText = name
                table_row.appendChild(table_data)
                based_count_data.innerText = based_count
                table_row.appendChild(based_count_data)                
                
                nest.appendChild(table_row)
            })
            
        })
    }
    mainFunc()
</script>
</html>